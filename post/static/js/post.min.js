(function(){var addItem,format;format=function(date){return date.setHours(0,0,0),date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+"T00:00+00:00"},window.App=angular.module("post",["post.controllers","typeahead"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/dashboard",{templateUrl:window.prefix+"partials/post/dashboard.html",controller:"DashboardController"}),$routeProvider.when("/week",{templateUrl:window.prefix+"partials/post/week.html",controller:"WeekController"}),$routeProvider.when("/av",{templateUrl:window.prefix+"partials/post/av.html",controller:"AVController"}),$routeProvider.otherwise({redirectTo:"/dashboard"})}]),addItem={},angular.module("post.controllers",["post.apiv2"]).controller("DashboardController",["$scope","Item",function($scope,Item){var allItems;return $scope.search="",$scope.items=[],allItems=[],Item.all(function(items){return $scope.items=allItems=items}),addItem=function(item){return $scope.items.push(item)},$scope.next=function(){return $scope.items.next(function(items){return $scope.items=items})},$scope.previous=function(){return $scope.items.previous(function(items){return $scope.items=items})},$scope.$watch("search",function(){return $scope.search.length>1?Item.search($scope.search,function(items){return $scope.items=items}):$scope.items=allItems})}]).controller("FormController",["$scope","Category","Source","Item",function($scope,Category,Source,Item){return angular.element("input[ng-model='description']").focus(),$scope.categories=function(query,callback){return Category.search(query,function(categories){return callback(categories)})},$scope.sources=function(query,callback){return Source.search(query,function(sources){return callback(sources)})},$scope.submit=function(){var item;return $scope.sender&&$scope.receiver&&$scope.category&&$scope.description?(item=new Item,item.sender=$scope.sender_model.resource_uri,item.receiver=$scope.receiver_model.resource_uri,item.category=$scope.category_model.resource_uri,item.description=$scope.description,item.create(function(obj){return $scope.sender="",$scope.receiver="",$scope.category="",$scope.description="",addItem(obj),angular.element("input[ng-model='description']").focus()})):void 0}}]).controller("WeekController",["$scope","Item",function($scope,Item){var addDays,today;return $scope.items=[],addDays=function(date,days){var next;return next=new Date,next.setTime(date.getTime()+1e3*60*60*24*days),next},$scope.next=function(){return $scope.monday=addDays($scope.monday,7)},$scope.previous=function(){return $scope.monday=addDays($scope.monday,-7)},today=new Date,$scope.monday=new Date(today-1e3*60*60*24*((today.getDay()+6)%7)),$scope.$watch("monday",function(){return $scope.nextmonday=addDays($scope.monday,7),Item.between($scope.monday,$scope.nextmonday,function(items){return $scope.items=items})})}]).controller("AVController",["$scope","Item","Category",function($scope,Item,Category){var updateItems;return $scope.categories=[],$scope.datefrom=new Date,Category.all(function(categories){return $scope.categories=categories,$scope.categories.forEach(function(category){return category.items=[]})}),$scope.$watch("avdate",function(){var matches;return $scope.avdate&&(matches=$scope.avdate.match(/(\d{1,2})-(\d{1,2})-(\d{4})/))?($scope.datefrom.setFullYear(matches[3],matches[2]-1,matches[1]),updateItems()):void 0}),updateItems=function(){return $scope.categories.forEach(function(category){return Item._more({method:"GET",url:Item.api_root,params:{category:category.id,limit:0,date__gte:format($scope.datefrom)}},function(items){var counted;return category.items=[],counted=[],items.forEach(function(item){var found;return found=!1,counted.forEach(function(citem){return citem.description.toUpperCase()===item.description.toUpperCase()&&citem.sendername===item.sendername?(citem.count++,found=!0):void 0}),found===!1?(item.count=1,counted.push(item)):void 0}),category.items=counted,console.log(category.items)})})}}]),angular.module("post.apiv2",["dienst2"]).factory("Category",["Tastypie",function(Tastypie){var Category;return Category=Tastypie("api/v2/category/"),Category.prototype.toString=function(){return this.name},Category}]).factory("Source",["Tastypie",function(Tastypie){var Source;return Source=Tastypie("api/v2/source/"),Source.prototype.toString=function(){return this.name},Source}]).factory("Item",["Tastypie","$http",function(Tastypie){var Item;return Item=Tastypie("api/v2/item/"),Item.prototype.toString=function(){return this.description},Item.between=function(datefrom,dateto,success){return Item._more({method:"GET",url:Item.api_root,params:{limit:0,date__gte:format(datefrom),date__lt:format(dateto)}},success)},Item}])}).call(this);